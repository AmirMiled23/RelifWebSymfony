{% extends 'homepage.html.twig' %}

{% block title %}Conferences{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ asset('css/conference.css') }}">
    <link rel="stylesheet" href="{{ asset('css/ai-assistant.css') }}">
{% endblock %}

{% block body %}
<div class="container mt-5 mb-5">
    <h1 class="text-center mb-4 section-title">Upcoming Conferences</h1>
    <p class="text-center text-muted mb-5">Explore our curated list of insightful conferences.</p>

    <div class="row mb-4 justify-content-center">
        <div class="col-md-10 col-lg-8">
            <form class="filter-form p-4 rounded shadow-sm bg-light">
                <div class="row g-3 align-items-end">
                    <div class="col-md-5">
                        <label for="searchQuery" class="form-label">Search Conference</label>
                        <input type="text" class="form-control" id="searchQuery" placeholder="Enter title or presenter...">
                    </div>
                    <div class="col-md-3">
                        <label for="filterCategory" class="form-label">Category</label>
                        <select id="filterCategory" class="form-select">
                            <option selected disabled value="">Choose...</option>
                            <option value="Technology">Technology</option>
                            <option value="Business">Business</option>
                            <option value="Science">Science</option>
                            <option value="Art">Art</option>
                            <option value="Health">Health</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="filterLocation" class="form-label">Location</label>
                        <select id="filterLocation" class="form-select">
                            <option selected disabled value="">Choose...</option>
                            <option value="Online">Online</option>
                            <option value="New York">New York</option>
                            <option value="London">London</option>
                            <option value="Paris">Paris</option>
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for conference in pagination.items %}
            {% set now = "now"|date("U") %}
            {% set confDate = conference.dateConference ? conference.dateConference|date("U") : null %}
            {% set diffDays = confDate ? (confDate - now) / (60*60*24) : 9999 %}
            
            {% set cardClass = 'conference-card theme-' ~ conference.theme %}
            {% if diffDays < 7 and diffDays >= 0 %}
                {% set cardClass = cardClass ~ ' card-upcoming-soon' %}
            {% elseif diffDays > 30 %}
                {% set cardClass = cardClass ~ ' card-distant-future' %}
            {% endif %}
            
            {% set category_colors = {
                'Technology': 'primary', 'Business': 'success', 'Science': 'info',
                'Art': 'warning', 'Health': 'danger', 'Environnement': 'success',
                'Ecologie': 'success', 'Climat': 'info', 'Nature': 'success'
            } %}
            {% set badge_color = category_colors[conference.theme] ?? 'secondary' %}
            
            {% set initial = conference.presenteur|first|upper %}
            
            <div class="col conference-item">
                <div class="card h-100 {{ cardClass }}">
                    <span class="badge bg-{{ badge_color }} category-badge">{{ conference.theme }}</span>
                    
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="presenter-avatar">{{ initial }}</div>
                            <div>
                                <h5 class="card-title">{{ conference.titre }}</h5>
                                <p class="card-subtitle mb-0 text-muted">{{ conference.presenteur }}</p>
                            </div>
                        </div>
                        
                        <div class="conference-quick-info">
                            <div class="quick-info-item">
                                <div class="label">Date</div>
                                <div class="value">{{ conference.dateConference ? conference.dateConference|date('d M') : 'N/A' }}</div>
                            </div>
                            <div class="quick-info-item">
                                <div class="label">Places</div>
                                <div class="value">{{ conference.nbPlace }}</div>
                            </div>
                            <div class="quick-info-item">
                                <div class="label">Location</div>
                                <div class="value">{{ conference.lieu|length > 10 ? conference.lieu|slice(0, 10) ~ '...' : conference.lieu }}</div>
                            </div>
                        </div>
                        
                        {% if conference.prix == 0 %}
                            <div class="price-tag free">FREE</div>
                        {% else %}
                            <div class="price-tag">{{ conference.prix }} TND</div>
                        {% endif %}
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            {% if conference.status == 'En cours' %}
                                <span class="badge bg-success rounded-pill px-3 py-2">{{ conference.status }}</span>
                            {% elseif conference.status == 'Pas encore' %}
                                <span class="badge bg-warning text-dark rounded-pill px-3 py-2">{{ conference.status }}</span>
                            {% else %}
                                <span class="badge bg-secondary rounded-pill px-3 py-2">{{ conference.status }}</span>
                            {% endif %}
                            
                            <a href="{{ path('app_conference_show', {'id': conference.id}) }}" class="btn btn-modern">
                                Details <i class="bi bi-arrow-right-circle ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12">
                <div class="alert alert-info text-center shadow-sm">No conferences found matching your criteria.</div>
            </div>
        {% endfor %}
    </div>

    <div class="pagination-wrapper d-flex justify-content-center mt-5">
        {{ knp_pagination_render(pagination) }}
    </div>
</div>

{# Include AI Assistant Widget #}
{% include 'shared/_ai_assistant.html.twig' %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/ai-assistant.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                document.querySelectorAll('.conference-item').forEach(function(item, index) {
                    setTimeout(function() {
                        item.classList.add('show');
                    }, index * 100);
                });
            }, 100);
        });
    </script>
{% endblock %}
